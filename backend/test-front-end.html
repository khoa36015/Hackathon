<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Test API Miền Tây</title>
</head>
<body>
  <h2>Test API Miền Tây</h2>

  <div>
    <button onclick="loadProvinces()">Tải tất cả tỉnh</button>
  </div>

  <div style="margin-top: 12px;">
    <input id="searchInput" placeholder="Nhập tên tỉnh... (vd: can tho, an giang)">
    <button onclick="searchProvince()">Tìm</button>
  </div>

  <div style="margin-top: 12px;">
    <input id="detailInput" placeholder="Nhập id tỉnh... (vd: an_giang)">
    <button onclick="getDetail()">Xem chi tiết</button>
  </div>

  <h3>Kết quả</h3>
  <pre id="output">{}</pre>

  <h3>Danh sách tỉnh</h3>
  <ul id="list"></ul>

<script>
const API = "http://127.0.0.1:1311";

function show(data) {
  document.getElementById('output').textContent = JSON.stringify(data, null, 2);
}

async function loadProvinces() {
  const res = await fetch(API + "/api/provinces");
  const data = await res.json();
  show(data);
  const list = document.getElementById('list');
  list.innerHTML = "";
  data.forEach(item => {
    const li = document.createElement('li');
    li.textContent = item.ten + " (" + item.id + ")";
    li.style.cursor = "pointer";
    li.onclick = () => getDetailById(item.id);
    list.appendChild(li);
  });
}

async function searchProvince() {
  const q = document.getElementById('searchInput').value.trim();
  if (!q) return;
  const res = await fetch(API + "/api/search?name=" + encodeURIComponent(q));
  if (res.ok) {
    const data = await res.json();
    show(data);
  } else {
    show({error: "Không tìm thấy"});
  }
}

async function getDetail() {
  const id = document.getElementById('detailInput').value.trim();
  if (!id) return;
  getDetailById(id);
}

async function getDetailById(id) {
  const res = await fetch(API + "/api/province/" + id);
  if (res.ok) {
    const data = await res.json();
    show(data);
  } else {
    show({error: "Không tìm thấy tỉnh " + id});
  }
}

// tải sẵn
loadProvinces();
</script>
</body>
</html>
